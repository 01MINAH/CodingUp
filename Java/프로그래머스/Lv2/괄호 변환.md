```java
class Solution {
    public String solution(String p) {
        if (p.isEmpty()) return p;

        int balance = 0;
        int index = 0;
        do {
            if (p.charAt(index) == '(') balance++;
            else balance--;
            index++;
        } while (balance != 0);

        String u = p.substring(0, index);
        String v = p.substring(index);

        if (isCorrect(u)) {
            return u + solution(v);
        }

        StringBuilder sb = new StringBuilder();
        sb.append("(");
        sb.append(solution(v));
        sb.append(")");

        for (int i = 1; i < u.length() - 1; i++) {
            if (u.charAt(i) == '(') sb.append(')');
            else sb.append('(');
        }

        return sb.toString();
    }

    private boolean isCorrect(String s) {
        int count = 0;
        for (char c : s.toCharArray()) {
            if (c == '(') count++;
            else {
                if (count == 0) return false;
                count--;
            }
        }
        return true;
    }
}

```
